<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HavacÄ±lÄ±k & AOF SÄ±nav Sistemi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #64748b;
            --success: #22c55e;
            --danger: #dc2626;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: #0f172a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .app-container {
            background: var(--card);
            width: 100%;
            max-width: 900px;
            min-height: 750px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* SAYFA GEÃ‡Ä°ÅLERÄ° */
        .page {
            display: none;
            flex-grow: 1;
            padding: 40px;
            flex-direction: column;
            animation: fadeIn 0.3s ease-out;
        }
        .page.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* LOGIN */
        .login-wrapper { margin: auto; text-align: center; width: 100%; max-width: 400px; }
        .login-input {
            width: 100%; padding: 16px; border-radius: 8px; border: 2px solid var(--border);
            background: #f8fafc; font-size: 1.1rem; margin-bottom: 20px; text-align: center;
        }
        .login-input:focus { border-color: var(--primary); outline: none; background: #fff; }

        /* BUTONLAR */
        .btn {
            background: white; border: 2px solid var(--border); color: #334155;
            padding: 14px; border-radius: 8px; font-size: 1rem; font-weight: 600;
            cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-1px); }
        .btn-primary { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-primary:hover { background: var(--primary-dark); color: white; border-color: var(--primary-dark); }
        .btn-danger { background: #fee2e2; color: var(--danger); border-color: #fecaca; }
        .btn-danger:hover { background: var(--danger); color: white; border-color: var(--danger); }

        .grid-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }

        /* HEADER & USER */
        .user-header {
            position: absolute; top: 20px; right: 20px; z-index: 10;
            display: flex; align-items: center; gap: 15px;
            font-size: 0.9rem; color: var(--secondary);
            background: rgba(255,255,255,0.9); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--border);
        }
        .logout-link { color: var(--danger); cursor: pointer; font-weight: 600; }

        /* QUIZ ALANI */
        .quiz-top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .quiz-info-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .progress-container { width: 100%; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; margin-bottom: 20px; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }

        .question-text { font-size: 1.35rem; font-weight: 700; color: #1e293b; margin-bottom: 25px; line-height: 1.5; }
        
        .option-card {
            padding: 18px; border: 2px solid var(--border); border-radius: 10px;
            cursor: pointer; transition: 0.2s; font-size: 1.05rem; margin-bottom: 10px;
            background: white; color: #334155; position: relative;
        }
        .option-card:hover { border-color: #94a3b8; background: #f1f5f9; }
        .option-card.correct { background: #dcfce7; border-color: var(--success); color: #14532d; font-weight: 600; }
        .option-card.incorrect { background: #fee2e2; border-color: var(--danger); color: #7f1d1d; }
        .option-card.hint { border-color: var(--success); background: #f0fdf4; color: var(--success); font-weight: 600; }

        /* NAVIGASYON */
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 25px; gap: 15px; }
        .nav-btn { flex: 1; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; border: none; font-size: 1rem; }
        .btn-prev { background: #e2e8f0; color: #475569; }
        .btn-next { background: var(--primary-dark); color: white; }

        /* HIZLI ERÄ°ÅÄ°M GRID (YENÄ°) */
        .fast-access-container {
            margin-top: auto;
            border-top: 1px solid var(--border);
            padding-top: 20px;
        }
        .fast-access-title { text-align: center; font-size: 0.85rem; color: var(--secondary); margin-bottom: 10px; }
        .access-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(35px, 1fr));
            gap: 6px;
            max-height: 150px;
            overflow-y: auto;
            padding: 5px;
        }
        .access-btn {
            height: 35px;
            display: flex; align-items: center; justify-content: center;
            background: #f1f5f9; border: 1px solid #cbd5e1; border-radius: 6px;
            font-size: 0.85rem; font-weight: 500; color: #64748b; cursor: pointer;
            transition: all 0.1s;
        }
        .access-btn:hover { background: #e2e8f0; }
        .access-btn.current { border: 2px solid #0f172a; color: #0f172a; font-weight: 800; background: white; transform: scale(1.05); }
        .access-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .access-btn.incorrect { background: var(--danger); color: white; border-color: var(--danger); }

        /* SWITCH TOGGLE */
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { display:none; }
        .slider { position: absolute; cursor: pointer; top:0; left:0; right:0; bottom:0; background-color: #cbd5e1; transition:.3s; border-radius: 34px; }
        .slider:before { position: absolute; content:""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition:.3s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success); }
        input:checked + .slider:before { transform: translateX(20px); }
        .switch-label { font-size: 0.9rem; color: var(--secondary); font-weight: 600; margin-right: 10px; }

        /* SONUÃ‡ */
        .score-circle {
            width: 140px; height: 140px; border-radius: 50%;
            background: var(--primary); color: white;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            margin: 0 auto 20px; font-size: 2.5rem; font-weight: 800;
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.2);
        }
        
        /* SCROLLBAR */
        .access-grid::-webkit-scrollbar { width: 6px; }
        .access-grid::-webkit-scrollbar-track { background: #f1f1f1; }
        .access-grid::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

    </style>
</head>
<body>

<div class="app-container">
    
    <div id="user-info-panel" class="user-header" style="display: none;">
        <span>ğŸ‘¤ <b id="display-username">Misafir</b></span>
        <span class="logout-link" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</span>
    </div>

    <div id="page-login" class="page active">
        <div class="login-wrapper">
            <h1 style="color: var(--primary); margin-bottom: 10px;">SÄ±nav Sistemi</h1>
            <p style="color: var(--secondary); margin-bottom: 30px;">GiriÅŸ YapÄ±n</p>
            <input type="text" id="username-input" class="login-input" placeholder="AdÄ±nÄ±z">
            <button class="btn btn-primary" style="width:100%" onclick="login()">GiriÅŸ Yap</button>
        </div>
    </div>

    <div id="page-menu" class="page">
        <h2 style="color: #1e293b; margin-bottom: 20px;">Ana MenÃ¼</h2>
        
        <div class="grid-menu">
            <button class="btn" onclick="startQuiz('temel')">âœˆï¸ Temel Sorular (102)</button>
            <button class="btn" onclick="startQuiz('cikmis')">ğŸ“œ Ã‡Ä±kmÄ±ÅŸ Sorular (48)</button>
            <button class="btn" onclick="startQuiz('ai')">ğŸ¤– AI Ã–ÄŸretici (40)</button>
        </div>

        <button class="btn btn-primary" style="margin-bottom: 20px;" onclick="showPage('page-aof')">
            ğŸ“š AOF ModÃ¼lÃ¼ (Deneme/Final)
        </button>
        
        <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 20px;">
            <h4 style="margin:0 0 10px 0; font-size:0.9rem; color:var(--secondary);">HATA ANALÄ°ZÄ°</h4>
            <div id="mistake-stats" style="display:flex; gap:10px; flex-wrap:wrap;">
                <span style="color:#94a3b8; font-size:0.9rem;">HenÃ¼z veri yok.</span>
            </div>
        </div>

        <button class="btn" style="width: 100%;" onclick="startQuiz('mix')">ğŸ”€ TÃ¼mÃ¼nÃ¼ KarÄ±ÅŸtÄ±r</button>
    </div>

    <div id="page-aof" class="page">
        <button class="btn" style="width: auto; align-self: flex-start; margin-bottom: 20px;" onclick="showPage('page-menu')">â† Geri</button>
        <h2 style="margin-bottom: 20px;">AOF SÄ±navlarÄ±</h2>
        <div class="grid-menu">
            <button class="btn" onclick="startQuiz('aof_deneme1')">ğŸ“ Deneme 1</button>
            <button class="btn" onclick="startQuiz('aof_deneme2')">ğŸ“ Deneme 2</button>
            <button class="btn" onclick="startQuiz('aof_final1')">ğŸ“ Final 1</button>
            <button class="btn" onclick="startQuiz('aof_final2')">ğŸ“ Final 2</button>
        </div>
        <button class="btn btn-primary" style="margin-top: 10px;" onclick="startQuiz('aof_mix')">ğŸ”€ KarÄ±ÅŸÄ±k AOF Testi</button>
    </div>

    <div id="page-quiz" class="page">
        <div class="quiz-top-bar">
            <div style="font-weight:700; font-size:1.1rem; color:var(--primary);" id="quiz-title">Test Modu</div>
            <button class="btn" style="padding: 6px 12px; font-size:0.85rem;" onclick="endQuiz()">Bitir âœ•</button>
        </div>

        <div class="progress-container"><div class="progress-fill" id="q-progress"></div></div>

        <div class="quiz-info-bar">
            <span style="font-weight:600; color:var(--secondary);" id="q-counter">Soru 1/10</span>
            <div style="display:flex; align-items:center;">
                <span class="switch-label">Otomatik GeÃ§</span>
                <label class="switch">
                    <input type="checkbox" id="auto-next" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="question-text" id="q-text">YÃ¼kleniyor...</div>
        <div id="q-options"></div>

        <div class="nav-buttons">
            <button class="nav-btn btn-prev" id="btn-prev" onclick="prevQuestion()">â† Ã–nceki</button>
            <button class="nav-btn btn-next" id="btn-next" onclick="nextQuestion()">Sonraki â†’</button>
        </div>

        <div class="fast-access-container">
            <div class="fast-access-title">HÄ±zlÄ± EriÅŸim</div>
            <div class="access-grid" id="fast-access-grid">
                </div>
        </div>
    </div>

    <div id="page-result" class="page">
        <div style="margin: auto; text-align: center;">
            <div class="score-circle">
                <span id="res-score">%0</span>
                <span style="font-size:0.9rem; font-weight:normal;">BAÅARI</span>
            </div>
            <h2 id="res-msg">SonuÃ§</h2>
            <p style="color:var(--secondary); margin-bottom:30px;">SonuÃ§lar kaydedildi.</p>
            
            <div style="display:flex; flex-direction:column; gap:15px; max-width:400px; margin:0 auto;">
                <button id="btn-retry-session" class="btn btn-danger" style="display:none;" onclick="retrySessionMistakes()">âš ï¸ Bu Testteki YanlÄ±ÅŸlarÄ± Ã‡Ã¶z</button>
                <button class="btn btn-primary" onclick="restartQuiz()">ğŸ”„ AynÄ± Testi Tekrarla</button>
                <button class="btn" onclick="showPage('page-menu')">ğŸ  Ana MenÃ¼</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- 1. VERÄ° HAVUZLARI ---
    
    // Ã–rnek Veri (Ã–nceki 190 soruyu buraya yapÄ±ÅŸtÄ±rÄ±n, kod uzunluÄŸu iÃ§in kÄ±saltÄ±ldÄ±)
    const basicQuestions = [
        { q: "HavacÄ±lÄ±k faaliyetleri kaÃ§a ayrÄ±lÄ±r?", options: ["ÃœÃ§e", "Ä°kiye", "DÃ¶rde", "BeÅŸe"], answer: "Ä°kiye" },
        { q: "Devlet hava araÃ§larÄ± nelerdir?", options: ["AskerÃ®, gÃ¼mrÃ¼k, polis", "Yolcu, kargo, eÄŸitim", "TarÄ±m, balon, planÃ¶r", "Helikopter, jet, planÃ¶r"], answer: "AskerÃ®, gÃ¼mrÃ¼k, polis" },
        { q: "1 foot kaÃ§ metredir?", options: ["0,25", "0,3048", "1,85", "3,048"], answer: "0,3048" }
    ];
    
    const pastQuestions = [
        { q: "ICAO KodlarÄ±na GÃ¶re HavaalanlarÄ± Ã¼lkemizde hangi harf ile baÅŸlamaktadÄ±r?", options: ["L", "T", "E", "A"], answer: "L" },
        { q: "BakÄ±mÄ±n yapÄ±ldÄ±ÄŸÄ± yere gÃ¶re bakÄ±m tÃ¼rleri nelerdir?", options: ["Hat BakÄ±mÄ±, Ãœs BakÄ±mÄ±", "Ã–nleyici, DÃ¼zeltici", "PlanlÄ±, PlansÄ±z", "AÄŸÄ±r, Hafif"], answer: "Hat BakÄ±mÄ±, Ãœs BakÄ±mÄ±" }
    ];

    const aiQuestions = [
        { q: "ICAO Annex 17 (Ek-17) hangi konuyu dÃ¼zenler?", options: ["Hava Trafik", "GÃ¼venlik (Security)", "Ã‡evre", "Arama Kurtarma"], answer: "GÃ¼venlik (Security)" }
    ];

    const aofData = {
        deneme1: [ { q: "AOF Deneme 1 Soru 1?", options: ["A", "B", "C", "D"], answer: "A" } ],
        deneme2: [ { q: "AOF Deneme 2 Soru 1?", options: ["X", "Y", "Z", "Q"], answer: "X" } ],
        final1: [ { q: "AOF Final 1 Soru 1?", options: ["1", "2", "3", "4"], answer: "1" } ],
        final2: [ { q: "AOF Final 2 Soru 1?", options: ["Evet", "HayÄ±r"], answer: "Evet" } ]
    };

    // --- 2. UYGULAMA MANTIÄI ---

    let currentUser = null;
    let currentPool = [];
    let currentIndex = 0;
    let userAnswers = []; // [ {selected: 'A', isCorrect: true/false}, null, ... ]

    // BaÅŸlangÄ±Ã§
    window.onload = function() {
        const savedUser = localStorage.getItem('havacilik_user');
        if (savedUser) {
            currentUser = savedUser;
            updateUserInfo();
            showPage('page-menu');
            renderMistakeMenu();
        } else {
            showPage('page-login');
        }
    };

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('user-info-panel').style.display = (id === 'page-login') ? 'none' : 'flex';
        if(id === 'page-menu') renderMistakeMenu();
    }

    // Login
    function login() {
        const val = document.getElementById('username-input').value.trim();
        if(!val) return alert("Ä°sim giriniz.");
        currentUser = val;
        localStorage.setItem('havacilik_user', val);
        updateUserInfo();
        showPage('page-menu');
    }

    function logout() {
        if(confirm("Ã‡Ä±kÄ±ÅŸ yapÄ±lsÄ±n mÄ±?")) {
            localStorage.removeItem('havacilik_user');
            currentUser = null;
            showPage('page-login');
        }
    }

    function updateUserInfo() {
        document.getElementById('display-username').textContent = currentUser;
    }

    // VeritabanÄ± (LocalStorage)
    function getDB() { return JSON.parse(localStorage.getItem('havacilik_db_v3') || '{}'); }
    function saveDB(data) { localStorage.setItem('havacilik_db_v3', JSON.stringify(data)); }

    // Hata Ä°statistiÄŸi GÃ¼ncelleme
    function updateStats(question, isCorrect) {
        let db = getDB();
        if(!db[currentUser]) db[currentUser] = { stats: {} };
        
        const key = question.q;
        if(!db[currentUser].stats[key]) {
            db[currentUser].stats[key] = { total: 0, correct: 0, wrong: 0, qObj: question };
        }
        
        let stat = db[currentUser].stats[key];
        stat.total++;
        if(isCorrect) stat.correct++; else stat.wrong++;
        stat.qObj = question;
        
        saveDB(db);
    }

    function renderMistakeMenu() {
        let db = getDB();
        let stats = db[currentUser] ? db[currentUser].stats : {};
        let critical = [], warning = [], info = [];

        Object.values(stats).forEach(item => {
            if(item.wrong > 0) {
                let rate = (item.correct / item.total) * 100;
                if(rate < 50) critical.push(item.qObj);
                else if(rate < 80) warning.push(item.qObj);
                else info.push(item.qObj);
            }
        });

        const container = document.getElementById('mistake-stats');
        container.innerHTML = '';

        if(critical.length > 0) container.innerHTML += `<button class="btn btn-danger" onclick="startMistakeQuiz('critical')">ğŸ”´ Kritik (${critical.length})</button>`;
        if(warning.length > 0) container.innerHTML += `<button class="btn" style="color:#b45309; border-color:#fcd34d; background:#fffbeb;" onclick="startMistakeQuiz('warning')">ğŸŸ  SÄ±k Hata (${warning.length})</button>`;
        if(info.length > 0) container.innerHTML += `<button class="btn" style="color:#1e40af; border-color:#bfdbfe; background:#eff6ff;" onclick="startMistakeQuiz('info')">ğŸ”µ Nadir (${info.length})</button>`;
        
        if(critical.length===0 && warning.length===0 && info.length===0) container.innerHTML = '<span style="color:#94a3b8;">HenÃ¼z hata kaydÄ± yok.</span>';
    }

    // Quiz BaÅŸlatma
    function startQuiz(type) {
        currentPool = [];
        if(type === 'temel') currentPool = [...basicQuestions];
        else if(type === 'cikmis') currentPool = [...pastQuestions];
        else if(type === 'ai') currentPool = [...aiQuestions];
        else if(type === 'mix') currentPool = [...basicQuestions, ...pastQuestions, ...aiQuestions];
        else if(type === 'aof_deneme1') currentPool = [...aofData.deneme1];
        else if(type === 'aof_deneme2') currentPool = [...aofData.deneme2];
        else if(type === 'aof_final1') currentPool = [...aofData.final1];
        else if(type === 'aof_final2') currentPool = [...aofData.final2];
        else if(type === 'aof_mix') currentPool = [...aofData.deneme1, ...aofData.deneme2, ...aofData.final1, ...aofData.final2];

        if(currentPool.length === 0) return alert("Soru bulunamadÄ±.");
        
        currentPool.sort(() => Math.random() - 0.5);
        initQuizUI();
    }

    function startMistakeQuiz(cat) {
        let db = getDB();
        let stats = db[currentUser].stats;
        let pool = [];
        
        Object.values(stats).forEach(item => {
            if(item.wrong > 0) {
                let rate = (item.correct / item.total) * 100;
                if(cat === 'critical' && rate < 50) pool.push(item.qObj);
                if(cat === 'warning' && rate >= 50 && rate < 80) pool.push(item.qObj);
                if(cat === 'info' && rate >= 80) pool.push(item.qObj);
            }
        });
        
        currentPool = pool;
        currentPool.sort(() => Math.random() - 0.5);
        initQuizUI();
    }

    function initQuizUI() {
        currentIndex = 0;
        userAnswers = new Array(currentPool.length).fill(null);
        showPage('page-quiz');
        loadQuestion();
    }

    // Soru YÃ¼kleme
    function loadQuestion() {
        const q = currentPool[currentIndex];
        document.getElementById('q-text').textContent = `${currentIndex+1}. ${q.q}`;
        document.getElementById('q-counter').textContent = `Soru ${currentIndex + 1} / ${currentPool.length}`;
        document.getElementById('q-progress').style.width = `${((currentIndex+1)/currentPool.length)*100}%`;

        const optsDiv = document.getElementById('q-options');
        optsDiv.innerHTML = '';

        q.options.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'option-card';
            btn.textContent = opt;
            btn.onclick = () => handleAnswer(opt, btn);
            optsDiv.appendChild(btn);
        });

        if(userAnswers[currentIndex]) restoreState();
        
        // Navigasyon Buton DurumlarÄ±
        document.getElementById('btn-prev').disabled = (currentIndex === 0);
        document.getElementById('btn-next').textContent = (currentIndex === currentPool.length - 1) ? 'Bitir' : 'Sonraki â†’';
        
        renderFastAccess();
    }

    function handleAnswer(selected, btn) {
        if(userAnswers[currentIndex]) return; // Zaten cevaplandÄ±

        const q = currentPool[currentIndex];
        const isCorrect = (selected === q.answer);
        
        userAnswers[currentIndex] = { selected, isCorrect, qObj: q };
        
        // Ä°statistik
        updateStats(q, isCorrect);
        
        // UI Boyama
        applyFeedback();
        renderFastAccess();

        // OTOMATÄ°K GEÃ‡Ä°Å MANTIÄI (DÃœZELTÄ°LDÄ°)
        const autoNext = document.getElementById('auto-next').checked;
        if(isCorrect && autoNext) {
            // ÅÄ±klara tÄ±klamayÄ± engelle
            const allOpts = document.querySelectorAll('.option-card');
            allOpts.forEach(o => o.style.pointerEvents = 'none');
            
            setTimeout(() => {
                if(currentIndex < currentPool.length - 1) {
                    nextQuestion();
                } else {
                    finishQuiz();
                }
            }, 700); // 0.7 saniye bekle
        }
    }

    function applyFeedback() {
        const ans = userAnswers[currentIndex];
        if(!ans) return;
        
        const q = currentPool[currentIndex];
        const opts = document.querySelectorAll('.option-card');
        
        opts.forEach(btn => {
            btn.style.pointerEvents = 'none';
            if(btn.textContent === q.answer) {
                btn.classList.add(ans.isCorrect ? 'correct' : 'hint');
            }
            if(btn.textContent === ans.selected && !ans.isCorrect) {
                btn.classList.add('incorrect');
            }
        });
    }

    function restoreState() { applyFeedback(); }

    // HÄ±zlÄ± EriÅŸim Paneli (YENÄ°)
    function renderFastAccess() {
        const grid = document.getElementById('fast-access-grid');
        grid.innerHTML = '';
        
        currentPool.forEach((_, i) => {
            const btn = document.createElement('div');
            btn.className = 'access-btn';
            btn.textContent = i + 1;
            
            // Stil Ata
            if (i === currentIndex) btn.classList.add('current');
            
            if (userAnswers[i]) {
                if (userAnswers[i].isCorrect) btn.classList.add('correct');
                else btn.classList.add('incorrect');
            }
            
            btn.onclick = () => {
                currentIndex = i;
                loadQuestion();
            };
            grid.appendChild(btn);
        });
    }

    // Navigasyon
    function nextQuestion() {
        if(currentIndex < currentPool.length - 1) {
            currentIndex++;
            loadQuestion();
        } else {
            finishQuiz();
        }
    }

    function prevQuestion() {
        if(currentIndex > 0) {
            currentIndex--;
            loadQuestion();
        }
    }

    function endQuiz() {
        if(confirm("Testi bitirmek istiyor musunuz?")) showPage('page-menu');
    }

    function finishQuiz() {
        const correct = userAnswers.filter(a => a && a.isCorrect).length;
        const score = Math.round((correct / currentPool.length) * 100);
        
        document.getElementById('res-score').textContent = `%${score}`;
        
        const msg = document.getElementById('res-msg');
        if(score >= 90) msg.textContent = "MÃ¼kemmel! ğŸš€";
        else if(score >= 70) msg.textContent = "GÃ¼zel! ğŸ‘";
        else msg.textContent = "GeliÅŸtirilmeli. ğŸ§";

        // YanlÄ±ÅŸlarÄ± Ã‡Ã¶z Butonu KontrolÃ¼
        const wrongOnes = userAnswers.filter(a => a && !a.isCorrect);
        const retryBtn = document.getElementById('btn-retry-session');
        
        if(wrongOnes.length > 0) {
            retryBtn.style.display = 'block';
            retryBtn.textContent = `âš ï¸ Bu Testteki ${wrongOnes.length} YanlÄ±ÅŸÄ± Ã‡Ã¶z`;
        } else {
            retryBtn.style.display = 'none';
        }

        showPage('page-result');
    }

    function restartQuiz() {
        currentPool.sort(() => Math.random() - 0.5);
        initQuizUI();
    }

    function retrySessionMistakes() {
        const wrongs = userAnswers.filter(a => !a.isCorrect).map(a => a.qObj);
        currentPool = wrongs;
        currentPool.sort(() => Math.random() - 0.5);
        initQuizUI();
    }

</script>
</body>
</html>
